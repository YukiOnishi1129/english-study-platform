# UNIT CSV インポート仕様

UNIT 詳細ページ（例: `/materials/{materialId}/chapters/{chapterId}/units/{unitId}`）で利用できる「CSV で問題を取り込む」機能の仕様をまとめています。CSV のエンコードは UTF-8（BOM なし推奨）で保存してください。

---

## 1. カラム定義

| 列名           | 必須 | 内容                                                                                                                    |
|----------------|------|-------------------------------------------------------------------------------------------------------------------------|
| 関連ID         | 任意 | 既存問題を更新する場合に指定。空欄の場合は新規問題として扱われます。`問題ID` という列名でも読み込めます。          |
| 並び順         | 任意 | 数値で指定。空欄の場合は既存順序を維持。新規の場合は末尾に追加されます（CSV 解析後、UI 上で並び順を確認できます）。 |
| 日本語         | ✅   | 問題文（日本語）。                                                                                                      |
| ヒント         | 任意 | 問題に対する補助ヒント。                                                                                                |
| 解説           | 任意 | 問題の解説や補足。                                                                                                      |
| 英語正解1      | ✅   | 正解文のメイン回答。                                                                                                    |
| 英語正解2〜    | 任意 | `英語正解2`, `英語正解3`, … と連番で追加可能。空欄は無視されます。                                                    |

> **メモ**  
> 列名は半角スペース無しで記述してください（例: `英語正解1`）。必要に応じて `英語正解3`, `英語正解4`… を追加できます。

---

## 2. サンプル CSV

| 関連ID | 並び順 | 日本語               | ヒント                    | 解説                                  | 英語正解1             | 英語正解2           |
|--------|--------|----------------------|---------------------------|---------------------------------------|-----------------------|---------------------|
|        | 1      | 朝の挨拶をしましょう | 朝は Good morning が定番 | フォーマルな場面でも Good morning を使う | Good morning.         | Morning!            |
| q-1234 | 2      | こんにちはと伝える   | Hi はカジュアル           | 既存問題を上書き（関連ID 指定）       | Hello.                | Hi.                 |
|        |        | 誰かに会えて嬉しいと伝える |                           |                                       | Nice to see you.      | Great to see you!   |

- 1 行につき 1 問を表します。
- `関連ID` が空欄の行は新規問題になります。
- `関連ID` を入力した行は、該当 ID の問題を上書きする前提で解析されます。ID 不一致の場合はエラーとして表示されます。
- `英語正解` 列は `英語正解1`, `英語正解2`, … と連番で必要なだけ追加してください。空欄は無視されます。

---

## 3. 管理画面での手順（UNIT詳細ページ）

1. 対象 UNIT の詳細ページにアクセス  
   例: `/materials/{materialId}/chapters/{chapterId}/units/{unitId}`
2. 「CSVで問題を取り込む」セクション内の「CSVファイルを選択」をクリック
3. CSV を選択すると即座にブラウザで解析され、以下の情報がプレビューされます
   - CSV 内の行数
   - 新規追加と更新の見込み数
   - 行ごとの明細（関連ID、日本語、正解群、ヒント、解説、並び順）
4. 内容を確認したら「取り込みを実行」をクリックすると DB に反映されます  
   （関連IDが一致する行は上書き、空欄の行は新規問題として追加されます）。

---

## 4. エラーハンドリング

CSV 解析時に以下のチェックを行い、問題があればプレビューエリアにエラーメッセージを表示します。

- 必須列（日本語・英語正解1）が空欄
- `並び順` に数値以外が入力されている
- `関連ID` が指定されているが既存データに該当がない（将来の取り込み時に検証予定）
- 行内がすべて空欄 → スキップ（エラーではありません）

---

## 5. 今後の拡張予定

- CSV 取り込みと既存問題の差分確認 UI の提供
- 取り込み時のバリデーション強化（関連ID の存在確認、並び順の自動整列など）

仕様が更新された場合、本ドキュメントを新版としてメンテナンスします。
